---
title: "2018 EDA_Summary"
author: "Marty Simonson"
date: "November 12, 2018"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r,include=FALSE}
packages<-function(x, repos="http://cran.r-project.org", ...){
x<-as.character(match.call()[[2]])
if (!require(x,character.only=TRUE)){
install.packages(pkgs=x, repos=repos, ...)
require(x,character.only=TRUE)
}
}

remove.packages(c("ggplot2", "data.table"))
install.packages('Rcpp', dependencies = TRUE)
install.packages('ggplot2', dependencies = TRUE)
install.packages('data.table', dependencies = TRUE)

packages(rcompanion)
packages(vegan)
packages(ggplot2)
packages(gridExtra)
packages(reshape2)
packages(FSA)
packages(nnet)
#packages(multcomp)
#packages(plyr)
#packages(rv)
#packages(arm)
packages(lattice)
packages(tikzDevice)
#packages(GGally)
packages(wesanderson)
#packages(DescTools)
#packages(mvnormtest)
#packages(HH)
#packages(biotools)
#packages(car)
#packages(psych)
#packages(GPArotation)
#packages(doBy)
```



# Load in data and summarize, look for glaring errors:
```{r}
data<-read.csv("2018_Data_compiled.csv",header=T)
headTail(data)

str(data)

###################
#
#     Data Management: Columns formatting
#
###################

# Date
levels(data$Date)
data$Date<-as.Date(data$Date, format = "%m/%d/%Y")
str(data$Date)


# Lake
summary(data$Lake)
data$Lake[data$Lake == "SIlver"] <- "Silver"
data$Lake[data$Lake == "silver"] <- "Silver"
data$Lake[data$Lake == "Silver (Dickinson)"] <- "Silver"
data$Lake<-droplevels(data)$Lake

# TAG.NUMBER - Already a factor
summary(data$TAG.NUMBER)
data$TAG.NUMBER[data$TAG.NUMBER == ""] <- NA # set non-tagged fish to NA
summary(data$TAG.NUMBER)
    # don't think anything else needs to be adjusted. mis-keys would be terrible.

# Species
levels(data$Species) #KOI could be an issue, as with BMB and CAP for abbreviations
data$TAG.NUMBER[data$Species == "KOI"]
data$Species[data$Species == "KOI"] <- "COC"
data$Species[data$Species == "CAP"] <- "COC"
data$Species[data$Species == "BMB"] <- "BIB"
data$Species[data$Species == "YL Bass"] <- "YLB"
data$Lake[data$Species == "YLB"]
data$Species<-droplevels(data$Species)
# Confirm the abbreviations: Yellow Bullhead = YEB; Yellow Bass = YLB

# Length..mm.
str(data$Length..mm.)
data$Length..mm.[data$Length..mm. ==""] <- NA
data$Length..mm.[data$Length..mm. =="0"] <- NA
data$Length..mm.<-as.numeric(as.character(data$Length..mm.))
str(data$Length..mm.)
summary(data$Length..mm.) # seems legit! only 33 missing values. 
# 
# Don't forget to put the character command within the numeric!


# Weight..g.
# Needs to be rounded to whole numbers
summary(data$Weight..g.)
# Maximum is now good (30.6 lb buffalo in Storm)
# Minimum is 13 (yellow bass north twin)
data$Weight..g.<-round(data$Weight..g.)



```

# Silver Lake Carp Summary
```{r}
# Length Frequency Histogram of COC in Silver Lake, IA

silver.coc<-subset(data, Species == "COC")
silver.coc<-subset(silver.coc, Lake == "Silver")
silver.coc<-subset(silver.coc, !is.na(silver.coc$Length..mm.))
head(silver.coc)
str(silver.coc)

library(ggplot2)

ggplot(silver.coc, aes(x=Length..mm., fill=Species))+
  geom_histogram(binwidth=10,colour="black",position="dodge")+
  scale_x_continuous(limits = c(0,1000))+
  scale_y_continuous(limits = c(0,60))

library(rcompanion)
groupwiseMean(Length..mm.~1,
              data = silver.coc,
              conf = 0.95,
              digits = 3)

sem<-sd(silver.coc$Length..mm.)/sqrt(length(silver.coc$Length..mm.))

# cpue for coc in silver lake in june
#
# CarpCPUE - n fish per hour electrofishing
#
summary(silver.coc)
# on-time in seconds to Effort in hours
       # Need to remove seine hauls and NAs
str(silver.coc$On.Time..s.)
silver.coc$On.Time..s.[silver.coc$On.Time..s. == ""] <- NA
silver.coc$On.Time..s.[silver.coc$On.Time..s. == "453/488"] <- "941"
silver.coc$On.Time..s.<-as.numeric(as.character(silver.coc$On.Time..s.))
silver.coc$Effort<-silver.coc$On.Time..s./3600



# now to paste date, then lake then run
silver.coc$DR<-factor(paste(silver.coc$Date,silver.coc$Site.Transect))

# Now to divide the count of captured fish by the mean effort per DLR
coc.cpue<-aggregate(Effort~DR, data = silver.coc, mean, na.action=NULL)
silver.coc$dummy<-1
coc.n<-aggregate(dummy~DR, data = silver.coc, sum)
coc.cpue$n<-coc.n$dummy
coc.cpue$cpue<-coc.cpue$n/coc.cpue$Effort
coc.cpue<-coc.cpue[!is.na(coc.cpue$cpue),]

june.coc.cpue<-coc.cpue[c(12:44),]
groupwiseMean(cpue~1,
              data=june.coc.cpue,
              conf = 0.95)

```



