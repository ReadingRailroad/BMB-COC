# 2019 tag exploitation rate estimates
## importing data from 2019 only

## first file is tagging data from 2019

## second file is harvest tag recovery #s From N twin and Silver

## will want to split tags by Species (known from first file)
## Estimate exploitation rate as % of 2019 tags harvested

## N twin is tricky due to November 387 tagged fish...


## Load in data, do Silver first

##### 
# Front Matter
setwd("~/BMB-COC")

#2019 tagging data
nineteen<-read.csv("2019 Carp and Buffalo Data Entry.csv")
str(nineteen)
levels(nineteen$Lake)
nineteen$Lake[nineteen$Lake == "N. Twin"] <- "N Twin"
nineteen<-droplevels(subset(nineteen, Species == "COC" |
                                      Species == "BIB"))
Silver19<-droplevels(subset(nineteen, Lake == "Silver"))
NTwin19<-droplevels(subset(nineteen, Lake == "N Twin"))

# 2019 harvest data
harvest<-read.csv("2019  Harvest Tag Recovery.csv")
str(harvest)
levels(harvest$Lake)
harvest$Lake[harvest$Lake == "N. Twin"] <- "N Twin"
SilverHarvest<-droplevels(subset(harvest, Lake == "Silver"))
NTwinHarvest<-droplevels(subset(harvest, Lake == "N Twin"))


# Silver first, most straightforward
## Find # of tags from harvest that came from each species in Silver Lake
## setdiff(x,y) provides values in X but not in Y, where X and Y can be vectors or data frames

length(setdiff(SilverHarvest$TAG.NUM, Silver19$TAG.NUM))
# 83 tags recovered were NOT from 2019 tagging events
tags19<-length(SilverHarvest$TAG.NUM)-83
# so 150 tags recovered ARE in 2019 tagging events


# First crack at exploitation:
#### Denominator is total number of 2019 tags deployed for that species
#### Numerator is total number of 2019 tags recovered by each species.
silver.buff.exploit<-(length(SilverHarvest$TAG.NUM)-length(setdiff(SilverHarvest$TAG.NUM,Silver19$TAG.NUM[Silver19$Species=="BIB"]))) /
                      (length(Silver19$TAG.NUM[Silver19$Species == "BIB"]))
silver.carp.exploit<-(length(SilverHarvest$TAG.NUM)-length(setdiff(SilverHarvest$TAG.NUM,Silver19$TAG.NUM[Silver19$Species=="COC"]))) /
                      (length(Silver19$TAG.NUM[Silver19$Species == "COC"]))
# Is overall exploitation the same as the sum of both exploitation rates?
silver.exploit<-(length(SilverHarvest$TAG.NUM)-length(setdiff(SilverHarvest$TAG.NUM,Silver19$TAG.NUM))) /
                  (length(Silver19$TAG.NUM)) # not currently. gotta check with someone else!

silver<-data.frame(silver.exploit,silver.buff.exploit,silver.carp.exploit)
silver


#### Try with N Twin now
NTwin.buff.exploit<-(length(NTwinHarvest$TAG.NUM)-length(setdiff(NTwinHarvest$TAG.NUM,NTwin19$TAG.NUM[NTwin19$Species=="BIB"]))) /
  (length(NTwin19$TAG.NUM[NTwin19$Species == "BIB"]))
NTwin.carp.exploit<-(length(NTwinHarvest$TAG.NUM)-length(setdiff(NTwinHarvest$TAG.NUM,NTwin19$TAG.NUM[NTwin19$Species=="COC"]))) /
  (length(NTwin19$TAG.NUM[NTwin19$Species == "COC"]))
# Is overall exploitation the same as the sum of both exploitation rates?
NTwin.exploit<-(length(NTwinHarvest$TAG.NUM)-length(setdiff(NTwinHarvest$TAG.NUM,NTwin19$TAG.NUM))) /
  (length(NTwin19$TAG.NUM)) # not currently. gotta check with someone else!

NTWIN<-data.frame(NTwin.exploit,NTwin.buff.exploit,NTwin.carp.exploit)
NTWIN


# remember that final tagging day after population was already harvested then harvested again.(11/10/19)
### Could exclude that day up front and not use it in exploitation estimates?
## Shoot for my own consience I'll try to see how different N Twin is without that final tag day

levels(NTwin19$Date)
NTwin19.2<-droplevels(subset(NTwin19, Date != "11/10/19"))
# Same as before
NTwin.buff.exploit<-(length(NTwinHarvest$TAG.NUM)-length(setdiff(NTwinHarvest$TAG.NUM,NTwin19$TAG.NUM[NTwin19.2$Species=="BIB"]))) /
  (length(NTwin19$TAG.NUM[NTwin19$Species == "BIB"]))
NTwin.carp.exploit<-(length(NTwinHarvest$TAG.NUM)-length(setdiff(NTwinHarvest$TAG.NUM,NTwin19$TAG.NUM[NTwin19.2$Species=="COC"]))) /
  (length(NTwin19$TAG.NUM[NTwin19$Species == "COC"]))
# Is overall exploitation the same as the sum of both exploitation rates? Not so below.
NTwin.exploit<-(length(NTwinHarvest$TAG.NUM)-length(setdiff(NTwinHarvest$TAG.NUM,NTwin19$TAG.NUM))) /
  (length(NTwin19$TAG.NUM)) # not currently. gotta check with someone else!

NTWIN<-data.frame(NTwin.exploit,NTwin.buff.exploit,NTwin.carp.exploit)
NTWIN
# hardly changed. Good to see here.

# checking sum?
(NTWIN$NTwin.buff.exploit+NTWIN$NTwin.carp.exploit)
# checking average
(NTWIN$NTwin.buff.exploit+NTWIN$NTwin.carp.exploit)/2
# hell check the difference

(NTWIN$NTwin.buff.exploit-NTWIN$NTwin.carp.exploit)
# Closer... ask brandon upstairs