---
title: "2020 rmark input file"
author: "Martin Simonson"
date: "2/5/2020"
output: pdf_document
editor_options: 
  chunk_output_type: console
---


```{r}
library(RMark)
library(dplyr)
setwd("~/BMB-COC/MARK/2020")
df<-read.csv("2017-2020 Compiled Data.csv",header=T)
df$Date<-as.Date(df$Date, "%m/%d/%Y")
df$Month<-factor(format(df$Date, "%m"))
df$Year<-factor(format(df$Date, "%Y"))

str(df)
```

# getting capture history together

```{r}
# for the moment, let's just do center lake 

# and for the moment buffalo only:

df<-droplevels(subset(df, Lake == "Center" &
                          Species == "BIB" &
                          !is.na(df$TAG.NUMBER)))
# remove dissections and others
df$TAG.NUMBER[df$TAG.NUMBER == ""]<-NA
df<-droplevels(subset(df, !is.na(as.numeric(as.character(df$TAG.NUMBER)))))
levels(df$Notes)



# condense to year and tag number and detect

df<-df[,c(3,21,22)]

# remove dissection fish, 
levels(df$TAG.NUMBER)
capt.hist<-df %>%
  # remove duplicates when fish are caught more than once in an event
  distinct() %>%
  # spread out data. Fill = 0 adds rows for combinations of ID and event w/o observations
  spread(Year, detect, fill = 0) %>%
  # for every individual
  group_by(TAG.NUMBER) %>%
  # paste together 0s and 1s
  # unite is similar to paste
  unite("ch",2:tail(names(.),1),sep = "")

# well that worked, now to make it a .inp file
c.b.ch<-capt.hist[,2]

################
# applying mark

center.buff.cjs<-mark(c.b.ch)



cleanup()
```

