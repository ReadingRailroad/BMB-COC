---
title: "Stat 534 Homework 1"
author: "Marty Simonson"
date: "September 24, 2019"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

# 1.) 

Given a data file on abundance of _Alseis blackiana_ in two habitats (OldHigh and OldSlope). Assume that the counts follow a Negative Binomial distribution, and paramaterize in terms of the mean $\mu$ and overdispersion parameter $\theta$.

## a) 

Ignore habitat and find the MLE of mean and $\theta$, the overdispersion parameter. 

```{r}
#rm(list=ls())
ab<-read.csv("STAT534/Ab.csv",header=T)
str(ab)

NBlnl<- function(beta,data) {
  mu <- beta[1]
  size <- beta[2]
  sum(dnbinom(data,size,mu=mu,log=t))
}

# Try for mu and theta

one.a<-optim(c(20,5), NBlnl, method = 'BFGS', data = ab$Count,
      control = list(fnscale=-1))
mu<-one.a$par[1]
size<-one.a$par[2]

theta<- ((mu+(mu^2/size))-mu)/mu^2
```

The overall numerical optimization of the maximum likelihood parameters $\mu$ and $\theta$ are 20.400 and 0.307, respectively.

## b)

Fit a model that allows habitat-specific means and shared overdispersion. Find the mle's of the difference in means (as OldHigh - OldSlope) and the overdispersion.

```{r}

NBlnl2<- function(beta, data) {
  mu<-beta[1] + data$X*beta[2]
  size <- beta[3]
  sum(dnbinom(data$Count,size,mu=mu,log=T))
}

levels(ab$Habitat)
ab$X[ab$Habitat == "OldSlope"]<-0
ab$X[ab$Habitat == "OldHigh"]<-1

fit.b<-optim(c(20,
               20,
               5),
             NBlnl2,method='BFGS',data=ab,
             control=list(fnscale=-1),
             hessian=T)
mu.difference<-fit.b$par[2]
theta<-1/fit.b$par[3]

mu.difference

theta

```

The MLE for the difference in means between OldHigh - OldSlope is 17.875 and the MLE of the overdispersion parameter theta is 0.14


## c) 

Use the results from (b) to construct a normal approximation 95% confidence interval for the difference in means.

```{r}
betahat<-fit.b$par
fit.b.vc<-solve(-fit.b$hessian)
fit.b.se<-sqrt(diag(fit.b.vc))

mu.difference.ci<-cbind(
  lower = betahat - qnorm(0.975)*fit.b.se,
  upper = betahat + qnorm(0.975)*fit.b.se)
mu.difference.ci[2,]
```

The 95% normal approximation for the difference in means between habitat is between 8.255 to 27.494.

## d)

Use results from this model (and perhaps other models) to construct a likelihood ratio test __LRT__ of the $H_0: \mu_{OldHigh} = \mu_{OldSlope}$. Report the value of the test statistic and and p-value.

```{r}

```



## e)

Fit a model (or models) that allows habitat-specific means and habitat specific overdispersion. Find the MLE's of the two means and the two overdispersion parameters.

```{r}

```




## f)

Use results from this model (and perhaps other models) to construct a likelihood ratio test of $H_0: \theta_{OldHigh} = \theta_{OldSlope}$. Report the value of your test statistic and a p-value.

```{r}

```



## g)

Calculate a 95% _profile likelihood_ confidence interval for the difference in means. Note: this will require writing a function that enables finding the mle of one group's mean abundance and the shared overdispersion givena specified difference in means.

```{r}

```


# 2


