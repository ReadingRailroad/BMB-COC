---
title: "Marcus Age Comparison Plots"
author: "Martin Simonson"
date: "April 19, 2019"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r,include=F}
rm(list=ls())

packages<-function(x, repos="http://cran.r-project.org", ...){
x<-as.character(match.call()[[2]])
if (!require(x,character.only=TRUE)){
install.packages(pkgs=x, repos=repos, ...)
require(x,character.only=TRUE)
}
}

packages(vegan)
packages(ggplot2)
packages(reshape2)
packages(nnet)
packages(multcomp)
packages(plyr)
packages(rv)
packages(arm)
packages(lattice)
packages(tikzDevice)
packages(gridExtra)
packages(dplyr)

```


```{r,}
## Age comparison plots for North Twin Lake
#
# Buffalo and Carp
#
#
age<-read.csv("Marcus/BuffaloAges_Compiled.csv",header=T)
summary(age)


##############################################################

# Dorsals
        # marcus v drake
p1<-ggplot(age, aes(carp,x=Marcus_Dorsal, y=Drake_Dorsal))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Dorsal Spine Buffalo Age: Marcus vs. Drake")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p1

        # marcus v Marty
p2<-ggplot(age, aes(x=Marcus_Dorsal, y=Marty_Dorsal))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Dorsal Spine Buffalo Age: Marcus vs. Marty")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p2

        # Drake v Marty
p3<-ggplot(age, aes(x=Drake_Dorsal, y=Marty_Dorsal))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Dorsal Spine Buffalo Age: Drake vs. Marty")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p3

##############################################################
        

# Pectoral spines


        # marcus v drake
p4<-ggplot(age, aes(carp,x=Marcus_Pectoral, y=Drake_Pectoral))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Pectoral Spine Buffalo Age: Marcus vs. Drake")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p4

        # marcus v Marty
p5<-ggplot(age, aes(x=Marcus_Pectoral, y=Marty_Pectoral))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Pectoral Spine Buffalo Age: Marcus vs. Marty")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p5

        # Drake v Marty
p6<-ggplot(age, aes(x=Drake_Pectoral, y=Marty_Pectoral))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Pectoral Spine Buffalo Age: Drake vs. Marty")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p6

##############################################################

# sectioned otliths

        # marcus v drake
p7<-ggplot(age, aes(carp,x=Marcus_SectOto, y=Drake_SectOto))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Sectioned Otolith Buffalo Age: Marcus vs. Drake")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p7

        # marcus v Marty
p8<-ggplot(age, aes(x=Marcus_SectOto, y=Marty_SectOto))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Sectioned Otolith Buffalo Age: Marcus vs. Marty")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p8

        # Drake v Marty
p9<-ggplot(age, aes(x=Drake_SectOto, y=Marty_SectOto))+
  geom_point(size=5, alpha = 0.2)+
  geom_abline(slope = 1, intercept = 0)+
  ggtitle("Sectioned Otolith Buffalo Age: Drake vs. Marty")+
  theme_classic()+
  xlim(0,20)+
  ylim(0,20)
p9

##############################################################

grid.arrange(p1,p4,p7,
             p2,p5,p8,
             p3,p4,p9,
             ncol=3)


```


# Coefficient of Variation computation

FOR EACH STRUCTURE:

\[
CV_j = 100\% * \frac{\sqrt{\Sigma_{i=1}^{R}\frac{(X_{ij}-X_j)^2}{R-1}}}{X_j}
\]

Where $CV_j$ is the age precision estimate for the $j$th fish. $X_{ij}$ is the $i$th age determination of the $j$th fish, $X_j$ is the mean age estimate of the $j$th fish, and $R$ is the number of times each fish is aged. 

Therefore, we need:

- $X_{ij}$: each of the 3 age estimates for each fish 

- $X_j$: the MEAN age estimate for each fish

- $R$: number of times each fish is aged. = 3

let's get to work!

```{r,}
ages<-read.csv("Marcus/VariationSheet.csv",header=TRUE)
head(ages)
ages<-droplevels(subset(ages, Structure != "SandOtolith"))
levels(ages$Structure)

ages$j<-paste(ages$Lake,ages$TAG.NUMBER,sep = ".")
ages$R<-3 # easy one. number of times fish is aged.

ages<-ages[,-c(1,2)]

head(ages)
# MeanAge = Xj



```

