---
title: "CPUE Plots"
author: "Martin A. Simonson"
date: "January 12, 2018"
output: pdf_document
editor_options: 
  chunk_output_type: console
---
```{r,include=FALSE}

rm(list=ls())
packages<-function(x, repos="http://cran.r-project.org", ...){
x<-as.character(match.call()[[2]])
if (!require(x,character.only=TRUE)){
install.packages(pkgs=x, repos=repos, ...)
require(x,character.only=TRUE)
}
}

packages(vegan)
packages(ggplot2)
packages(gridExtra)
packages(reshape2)
packages(nnet)
#packages(multcomp)
#packages(plyr)
#packages(rv)
#packages(arm)
packages(lattice)
packages(tikzDevice)
#packages(GGally)
packages(wesanderson)
packages(devtools)
#packages(DescTools)
#packages(mvnormtest)
#packages(HH)
#packages(biotools)
#packages(car)
#packages(psych)
#packages(GPArotation)
packages(dplyr)
packages(tidyr)
packages(rcompanion)
```

# Per MJW Request:
Scatterplot and Correlation for biomass vs. CPUE for each species, which each lake represented by 1 point with 95% CI

very preliminary at this point and future refinement of how to calculate CPUE is necessary, but we need to describe the relationship somehow.

# ALL 2017 DATA

```{r,}
# Create DF with CPUE and 95% CI for each lake...

Lakes<-c("Blue","Center","North Twin","South Twin")
CarpBiomass <- c(120617,57932,9001,51187)
CarpDensity <- c(438.6,231.7,19.4,92.2)
BuffBiomass <- c(NA,81894,104513,26802)
BuffDensity <- c(NA,327.6,225.7,48.3)
CarpCPUE<-c(80.37,36.3,17.18,41.78)
BuffCPUE<-c(NA,102.29,24.56,64.65)
CarpLL<-c(59.99,22.41,9.74,29.96)
CarpUL<-c(100.76,50.20,24.63,53.05)
BuffLL<-c(NA,59.40,17.99,36.56)
BuffUL<-c(NA,145.17,31.14,95.32)
CarpBM.LL<-c(63432,45202,5387,29180)
CarpBM.UL<-c(224140,77317,17058,92395)
BuffBM.LL<-c(NA,70833,58659,21514)
BuffBM.UL<-c(NA,97419,185741,34005)

DF2017<-data.frame(Lakes,CarpBiomass,BuffBiomass,CarpBM.LL,CarpBM.UL,BuffBM.LL,BuffBM.UL,
               CarpCPUE,BuffCPUE,CarpLL,CarpUL,BuffLL,BuffUL)

summary(DF2017)

```

Now to create 2 plots, with regression lines (YAY!)

```{r,}

# visualize how CPUE changes as a function of biomass....
#
# I think biomass density might be beneficial here, but let's go with what MJW said

# Regression lines imply lm() but we'll see........

mod<-lm(CarpCPUE ~ CarpBiomass, data = DF2017)
summary(mod)
R2<-format(summary(mod)$r.squared,digits=3)


# Carp FIrst
carp<-ggplot(DF2017, aes(x=CarpBiomass, y=CarpCPUE)) +
  xlim(0,250000)+
  ylim(0,150)+
  geom_point(size=4) +
  geom_errorbar(aes(ymax = CarpUL, ymin = CarpLL),width=5000) +
  geom_errorbarh(aes(xmax= CarpBM.UL, xmin = CarpBM.LL),height=5) +
  annotate("text",x=c(130000,69000,25000,40000,10000,10000),y=c(85,33.3,12,49,140,130), 
           label = c("Blue","Center","North Twin","South Twin","R^2 = 0.972","p = 0.014")) +
  labs(title = "Relationship Between Common Carp Biomass and CPUE",
       x = "Estimated Common Carp Biomass (lbs.)",
       y = "Catch per Unit Effort (fish/hour)") +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  geom_smooth(method=lm,se=F) 


# Buffalo Second

mod2<-lm(BuffCPUE ~ BuffBiomass, data = DF2017)
summary(mod2)
R22<-format(summary(mod2)$r.squared,digits=3)
R22

buff<-ggplot(DF2017, aes(x=BuffBiomass, y=BuffCPUE)) +
  xlim(0,250000)+
  ylim(0,150)+
  geom_point(size=4) +
  geom_errorbar(aes(ymax = BuffUL, ymin = BuffLL),width=5000) +
  geom_errorbarh(aes(xmax=BuffBM.UL, xmin = BuffBM.LL),height=5) +
  annotate("text",x=c(90000,95000,38000,10000,10000),y=c(110,10,42,140,130), 
           label = c("Center","North Twin","South Twin","R^2 = 0.0902","p = 0.806")) +
  labs(title = "Relationship Between Bigmouth Buffalo Biomass and CPUE",
       x = "Estimated Bigmouth Buffalo Biomass (lbs.)",
       y = "Catch per Unit Effort (fish/hour)") +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  geom_smooth(method=lm,se=F)

# Problems here: when I remove the 0s from Blue Lake Buffalo, the regression is negative
# And the plot certainly doesn't look linear

grid.arrange(carp,buff,nrow=2,ncol=1)



```


I did what was asked, for now. That's all a person can really do.

# 2018 Data
- as of July 2018 - mixed ranges based on what spencer has entered
- as of July 23 2018 all samples up to 7-20 are entered (except the last 1 or 2 from Blue and Twins)
- collapse to averages (see below)
- still need catch n for CPUE but without seine hauls but with age structures

- CHANGING EVERYTHING BELOW TO INCORPORATE THE COMPILED DATA
__And need to add all the 0 fish / effort transects__
- as of 12/13/2018 I'll just ad the 0 fish 
__New 12-13-2018: importing "All.Biomass", the length-specific biomass and biomass density estimates from 2018.__ 
```{r}

# Create DF with CPUE, total biomass and biomass density (and 95% CIs) for each lake...

df<-read.csv("2018_COC_BIB_CMR_Data.csv",header=T) # load data 
head(df)
summary(df)


#
levels(df$Lake)
#

denframe<-read.csv("2018_BiomassDensityEstimates.csv",header=T)
denframe[,1]<-factor(c("Blue","Center","5 Island","N. Twin","S. Twin","Silver","Storm"))
head(denframe)
str(denframe)

```

- biomass and density data frame
-- with schnabel pop estimates from december 2018
```{r,}

# CarpBiomass - avg from 2018 length specific biomass density estimates (IN POUNDS)
BM<-denframe
colnames(BM)[1] <- "Lake"

# adding carp
BM$CarpN <- c(72140,6466,25798,3816,9755,20661,9251) # est carp abundance for 7 lakes as of 12/18/2018

# Buff pop estimates
BM$BuffN<- c(NA,3530,2300,18776,12486,34278,13724)


```

- CPUE data frame
```{r,}
###########################################
# CarpCPUE - n fish per hour electrofishing
#
coc.df<-subset(df,Species == "COC")                 # just carp
coc.df<-subset(coc.df, Gear == "Electroshocking")   # just e-fishing
coc.df<-subset(coc.df, !is.na(coc.df$On.Time..s.))  # only runs with recorded effort
coc.df$On.Time..s.<-as.numeric(coc.df$On.Time..s.)
str(coc.df)
# on-time in seconds to Effort in hours
coc.df$Effort<-coc.df$On.Time..s./3600

###########################################
# BuffCPUE - n fish per hour electrofishing
#
bib.df<-subset(df,Species == "BIB")                 # just Buff
bib.df<-subset(bib.df, Gear == "Electroshocking")   # just e-fishing
bib.df<-subset(bib.df, Lake != "Blue")              # removing the one buff caught at blue this year 
bib.df<-subset(bib.df, !is.na(bib.df$On.Time..s.))  # only runs with recorded effort
bib.df$On.Time..s.<-as.numeric(bib.df$On.Time..s.)
str(bib.df)
# on-time in seconds to Effort in hours
bib.df$Effort<-bib.df$On.Time..s./3600


# now to paste date/lake/run

coc.df$DLR<-factor(paste(coc.df$Date,coc.df$Lake,coc.df$Site.Transect, sep = ";"))
bib.df$DLR<-factor(paste(bib.df$Date,bib.df$Lake,bib.df$Site.Transect, sep = ";"))




##########################################
#
# CPUE
#
# Now to divide the count of captured fish by the mean effort per DLR
coc.cpue<-aggregate(Effort~Lake+DLR, data = coc.df, mean, na.action=NULL)
coc.df$dummy<-1
coc.n<-aggregate(dummy~Lake+DLR, data = coc.df, sum)
coc.cpue$n<-coc.n$dummy
coc.cpue$cpue<-coc.cpue$n/coc.cpue$Effort

  
# BuffCPUE -n fish per hour electrofishing

bib.cpue<-aggregate(Effort~Lake+DLR, data = bib.df, mean, na.action=NULL)
bib.df$dummy<-1
bib.n<-aggregate(dummy~Lake+DLR, data = bib.df, sum)
bib.cpue$n<-bib.n$dummy
bib.cpue$cpue<-bib.cpue$n/bib.cpue$Effort
bib.cpue<-bib.cpue[!is.na(bib.cpue$cpue),]



###############################################
#
#         data checking
#
#         Need to confirm EACH date/lake/run
#         and add in 0 values
BlueCheck<-subset(coc.cpue, Lake == "Blue")
levels(droplevels(BlueCheck$DLR))

FICheck<-subset(coc.cpue, Lake == "5 Island")
levels(droplevels(FICheck$DLR))

CenterCheck<-subset(coc.cpue, Lake == "Center")
levels(droplevels(CenterCheck$DLR))

NTCheck<-subset(coc.cpue, Lake == "N. Twin")
levels(droplevels(NTCheck$DLR))

SilverCheck<-subset(coc.cpue, Lake == "Silver")
levels(droplevels(SilverCheck$DLR))

STCheck<-subset(coc.cpue, Lake == "S. Twin")
levels(droplevels(STCheck$DLR))

StormCheck<-subset(coc.cpue, Lake == "Storm")
levels(droplevels(StormCheck$DLR))

################################################
BlueCheck<-subset(bib.cpue, Lake == "Blue")
levels(droplevels(BlueCheck$DLR))

FICheck<-subset(bib.cpue, Lake == "5 Island")
levels(droplevels(FICheck$DLR))

CenterCheck<-subset(bib.cpue, Lake == "Center")
levels(droplevels(CenterCheck$DLR))

NTCheck<-subset(bib.cpue, Lake == "N. Twin")
levels(droplevels(NTCheck$DLR))

SilverCheck<-subset(bib.cpue, Lake == "Silver")
levels(droplevels(SilverCheck$DLR))

STCheck<-subset(bib.cpue, Lake == "S. Twin")
levels(droplevels(STCheck$DLR))

StormCheck<-subset(bib.cpue, Lake == "Storm")
levels(droplevels(StormCheck$DLR))

##########################################################################################
#
#           Blue Lake is good. Not worrying about the 1 buffalo
#
#           Five Island Lake additions:
#                         At least 1 carp per transect somehow
#                         44 runs without a buffalo though. 44/78 runs. Shite!


a<-c("5 Island","2018-05-23;5 Island;2", 928/3600, 0, 0)
b<-c("5 Island","2018-05-23;5 Island;3", 1298/3600, 0, 0)
c<-c("5 Island","2018-05-23;5 Island;4", 904/3600, 0, 0)
d<-c("5 Island","2018-05-23;5 Island;5", 905/3600, 0, 0)
e<-c("5 Island","2018-05-23;5 Island;6", 965/3600, 0, 0)
f<-c("5 Island","2018-05-23;5 Island;7", 1126/3600, 0, 0)
g<-c("5 Island","2018-05-23;5 Island;8", 961/3600, 0, 0)
h<-c("5 Island","2018-05-23;5 Island;9", 1130/3600, 0, 0)

i<-c("5 Island","2018-06-06;5 Island;3", 1021/3600, 0, 0)
j<-c("5 Island","2018-06-06;5 Island;5", 1051/3600, 0, 0)

k<-c("5 Island","2018-06-12;5 Island;4", 1769/3600,0,0)

l<-c("5 Island","2018-06-28;5 Island;1", 1669/3600,0,0)
m<-c("5 Island","2018-06-28;5 Island;3", 1807/3600,0,0)
n<-c("5 Island","2018-06-28;5 Island;4", 1850/3600,0,0)

o<-c("5 Island","2018-07-12;5 Island;1", 963/3600,0,0)
p<-c("5 Island","2018-07-12;5 Island;3", 909/3600,0,0)
q<-c("5 Island","2018-07-12;5 Island;4", 910/3600,0,0)
r<-c("5 Island","2018-07-12;5 Island;5", 969/3600,0,0)
s<-c("5 Island","2018-07-12;5 Island;Bonus 1", 1331/3600,0,0)
t<-c("5 Island","2018-07-12;5 Island;Bonus 2", 1159/3600,0,0)
u<-c("5 Island","2018-07-12;5 Island;Bonus 3", 581/3600,0,0)
v<-c("5 Island","2018-07-12;5 Island;Bonus 4", 1074/3600,0,0)

w<-c("5 Island","2018-07-20;5 Island;Bonus 1", 3866/3600,0,0)
x<-c("5 Island","2018-07-20;5 Island;2", 1161/3600,0,0)
y<-c("5 Island","2018-07-20;5 Island;3", 1142/3600,0,0)
z<-c("5 Island","2018-07-20;5 Island;4", 1389/3600,0,0)
aa<-c("5 Island","2018-07-20;5 Island;5", 1306/3600,0,0)
bb<-c("5 Island","2018-07-20;5 Island;Bonus 4", 1588/3600,0,0)

cc<-c("5 Island","2018-07-25;5 Island;1", 3579/3600,0,0)
dd<-c("5 Island","2018-07-25;5 Island;3", 3485/3600,0,0)

ee<-c("5 Island","2018-08-01;5 Island;2", 1025/3600,0,0)
ff<-c("5 Island","2018-08-01;5 Island;3", 1291/3600,0,0)
gg<-c("5 Island","2018-08-01;5 Island;4", 1162/3600,0,0)
hh<-c("5 Island","2018-08-01;5 Island;Bonus 1", 4320/3600,0,0)

ii<-c("5 Island","2018-08-15;5 Island;1", 1678/3600,0,0)
jj<-c("5 Island","2018-08-15;5 Island;2", 1889/3600,0,0)
kk<-c("5 Island","2018-08-15;5 Island;3", 1899/3600,0,0)
ll<-c("5 Island","2018-08-15;5 Island;5", 1378/3600,0,0)

mm<-c("5 Island","2018-09-09;5 Island;3", 901/3600,0,0)
nn<-c("5 Island","2018-09-09;5 Island;4", 1060/3600,0,0)
oo<-c("5 Island","2018-09-09;5 Island;5", 1021/3600,0,0)

pp<-c("5 Island","2018-10-06;5 Island;4", 1053/3600,0,0)
qq<-c("5 Island","2018-10-06;5 Island;5", 939/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,
                           aa,bb,cc,dd,ee,ff,gg,hh,ii,jj,kk,ll,mm,nn,oo,pp,qq)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
bib.cpue<-rbind(bib.cpue,add.on)
#####################        AWESOME        ######################

##################################
#
# Center Lake
#       25 added to bib
#       13 added to coc
#
a<-c("Center","2018-05-25;Center;2",931/3600,0,0)
b<-c("Center","2018-05-25;Center;3",900/3600,0,0)
c<-c("Center","2018-05-25;Center;4",909/3600,0,0)
d<-c("Center","2018-05-25;Center;5",939/3600,0,0)

e<-c("Center","2018-05-31;Center;3",798/3600,0,0)
f<-c("Center","2018-05-31;Center;4",1432/3600,0,0)

g<-c("Center","2018-06-04;Center;2",1041/3600,0,0)
h<-c("Center","2018-06-04;Center;3",893/3600,0,0)
i<-c("Center","2018-06-04;Center;4",659/3600,0,0)
j<-c("Center","2018-06-04;Center;5",913/3600,0,0)

k<-c("Center","2018-06-11;Center;2",1010/3600,0,0)
l<-c("Center","2018-06-11;Center;3",672/3600,0,0)
m<-c("Center","2018-06-11;Center;4",599/3600,0,0)
n<-c("Center","2018-06-11;Center;5",762/3600,0,0)
o<-c("Center","2018-06-11;Center;Bonus 1",449/3600,0,0)

p<-c("Center","2018-06-19;Center;4",645/3600,0,0)
q<-c("Center","2018-06-19;Center;5",896/3600,0,0)

r<-c("Center","2018-07-19;Center;4",770/3600,0,0)
s<-c("Center","2018-07-19;Center;5",971/3600,0,0)

t<-c("Center","2018-07-30;Center;1",2218/3600,0,0)
u<-c("Center","2018-07-30;Center;5",772/3600,0,0)

v<-c("Center","2018-08-02;Center;1",1003/3600,0,0)
w<-c("Center","2018-08-02;Center;3",872/3600,0,0)
x<-c("Center","2018-08-02;Center;4",870/3600,0,0)
y<-c("Center","2018-08-02;Center;5",919/3600,0,0)


add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
bib.cpue<-rbind(bib.cpue,add.on)
# Now Carp!
a<-c("Center","2018-05-17;Center;2",917/3600,0,0)
b<-c("Center","2018-05-17;Center;3",893/3600,0,0)
c<-c("Center","2018-05-17;Center;5",932/3600,0,0)

d<-c("Center","2018-05-25;Center;1",925/3600,0,0)
e<-c("Center","2018-05-25;Center;2",931/3600,0,0)

f<-c("Center","2018-05-31;Center;4",1432/3600,7,7/(1432/3600))

g<-c("Center","2018-07-19;Center;2",848/3600,0,0)

h<-c("Center","2018-08-02;Center;1",1003/3600,0,0)
i<-c("Center","2018-08-02;Center;4",870/3600,0,0)

j<-c("Center","2018-09-08;Center;2",885/3600,0,0)
k<-c("Center","2018-09-08;Center;4",778/3600,0,0)

l<-c("Center","2018-10-05;Center;2",849/3600,0,0)
m<-c("Center","2018-10-05;Center;4",549/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l,m)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
coc.cpue<-rbind(coc.cpue,add.on)
####################################      AWESOME     ##########################



##############
# North Twin           
#
#       42 buffalo
#       16 carp
#
a<-c("N. Twin","2018-05-15;N. Twin;1",900/3600,0,0)
b<-c("N. Twin","2018-05-15;N. Twin;2",900/3600,0,0)

c<-c("N. Twin","2018-05-18;N. Twin;3",900/3600,0,0)

d<-c("N. Twin","2018-06-06;N. Twin;2",900/3600,0,0)



e<-c("N. Twin","2018-07-03;N. Twin;1",900/3600,0,0)
f<-c("N. Twin","2018-07-03;N. Twin;2",900/3600,0,0)
g<-c("N. Twin","2018-07-03;N. Twin;3",900/3600,0,0)

h<-c("N. Twin","2018-07-09;N. Twin;1",900/3600,0,0)
i<-c("N. Twin","2018-07-09;N. Twin;3",900/3600,0,0)

j<-c("N. Twin","2018-07-16;N. Twin;1",1667/3600,0,0)

k<-c("N. Twin","2018-08-01;N. Twin;2",900/3600,0,0)
l<-c("N. Twin","2018-08-01;N. Twin;3",900/3600,0,0)

m<-c("N. Twin","2018-08-06;N. Twin;1",900/3600,0,0)
n<-c("N. Twin","2018-08-06;N. Twin;2",900/3600,0,0)
o<-c("N. Twin","2018-08-06;N. Twin;3",900/3600,0,0)


p<-c("N. Twin","2018-11-01;N. Twin;1",905/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
bib.cpue<-rbind(bib.cpue,add.on)

# COC now
a<-c("N. Twin","2018-05-18;N. Twin;1",900/3600,0,0)

b<-c("N. Twin","2018-07-09;N. Twin;1",900/3600,0,0)

c<-c("N. Twin","2018-07-16;N. Twin;3",1224/3600,0,0)

d<-c("N. Twin","2018-07-31;N. Twin;2",1560/3600,0,0)

e<-c("N. Twin","2018-08-06;N. Twin;5",900/3600,0,0)

f<-c("N. Twin","2018-10-10;N. Twin;3",900/3600,0,0)

g<-c("N. Twin","2018-10-12;N. Twin;1",900/3600,0,0)
h<-c("N. Twin","2018-10-12;N. Twin;2",900/3600,0,0)
i<-c("N. Twin","2018-10-12;N. Twin;5",900/3600,0,0)

j<-c("N. Twin","2018-11-01;N. Twin;2",849/3600,0,0)
k<-c("N. Twin","2018-11-01;N. Twin;Bonus 2",1552/3600,0,0)
l<-c("N. Twin","2018-11-01;N. Twin;Bonus 3",1085/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
coc.cpue<-rbind(coc.cpue,add.on)



###################################
# Silver Lake
#       50 bib additions
#       8 carp additions
#
a<-c("Silver","2018-05-15;Silver;1",1871/3600,0,0)
b<-c("Silver","2018-05-18;Silver;5",927/3600,0,0)
c<-c("Silver","2018-07-11;Silver;6",996/3600,0,0)
d<-c("Silver","2018-07-18;Silver;3",1052/3600,0,0)
e<-c("Silver","2018-07-18;Silver;5",899/3600,0,0)
f<-c("Silver","2018-08-02;Silver;1",1116/3600,0,0)
g<-c("Silver","2018-10-05;Silver;5",549/3600,0,0)
h<-c("Silver","2018-10-05;Silver;6",804/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
coc.cpue<-rbind(coc.cpue,add.on)


# now 50 buffalo
a<-c("Silver","2018-05-24;Silver;6",894/3600,0,0)
b<-c("Silver","2018-06-01;Silver;8",1218/3600,0,0)
c<-c("Silver","2018-06-04;Silver;1",901/3600,0,0)
d<-c("Silver","2018-06-04;Silver;2",914/3600,0,0)
e<-c("Silver","2018-06-08;Silver;2",1560/3600,0,0)
f<-c("Silver","2018-06-08;Silver;3",720/3600,0,0)
g<-c("Silver","2018-06-09;Silver;1",1012/3600,0,0)
h<-c("Silver","2018-06-12;Silver;1",2171/3600,0,0)
i<-c("Silver","2018-06-12;Silver;3",2790/3600,0,0)
j<-c("Silver","2018-06-14;Silver;1",900/3600,0,0)
k<-c("Silver","2018-06-26;Silver;Bonus 3",3348/3600,0,0)
l<-c("Silver","2018-06-26;Silver;Bonus 4",2217/3600,0,0)
m<-c("Silver","2018-07-11;Silver;3",710/3600,0,0)
n<-c("Silver","2018-07-11;Silver;5",1124/3600,0,0)
o<-c("Silver","2018-07-11;Silver;Bonus",1510/3600,0,0)
p<-c("Silver","2018-07-18;Silver;2",2568/3600,0,0)
q<-c("Silver","2018-07-18;Silver;5",899/3600,0,0)
r<-c("Silver","2018-07-26;Silver;1",2294/3600,0,0)
s<-c("Silver","2018-07-26;Silver;2",4085/3600,0,0)
t<-c("Silver","2018-07-26;Silver;3",1910/3600,0,0)
u<-c("Silver","2018-07-26;Silver;4",2295/3600,0,0)
v<-c("Silver","2018-07-26;Silver;5",2408/3600,0,0)
w<-c("Silver","2018-07-26;Silver;7",3006/3600,0,0)
x<-c("Silver","2018-08-02;Silver;1",1116/3600,0,0)
y<-c("Silver","2018-08-02;Silver;2",1307/3600,0,0)
z<-c("Silver","2018-08-02;Silver;3",1121/3600,0,0)

aa<-c("Silver","2018-08-02;Silver;4",854/3600,0,0)
bb<-c("Silver","2018-08-02;Silver;5",1202/3600,0,0)
cc<-c("Silver","2018-08-02;Silver;6",923/3600,0,0)
dd<-c("Silver","2018-08-06;Silver;1",997/3600,0,0)
ee<-c("Silver","2018-08-06;Silver;2",1173/3600,0,0)
ff<-c("Silver","2018-08-06;Silver;3",1004/3600,0,0)
gg<-c("Silver","2018-08-06;Silver;4",688/3600,0,0)
hh<-c("Silver","2018-08-06;Silver;5",952/3600,0,0)
ii<-c("Silver","2018-08-06;Silver;6",810/3600,0,0)
jj<-c("Silver","2018-08-13;Silver;1",1866/3600,0,0)
kk<-c("Silver","2018-08-13;Silver;4",1760/3600,0,0)
ll<-c("Silver","2018-08-13;Silver;5",633/3600,0,0)
mm<-c("Silver","2018-09-08;Silver;1",1156/3600,0,0)
nn<-c("Silver","2018-09-08;Silver;2",1261/3600,0,0)
oo<-c("Silver","2018-09-08;Silver;3",1110/3600,0,0)
pp<-c("Silver","2018-09-08;Silver;5",1181/3600,0,0)
qq<-c("Silver","2018-09-08;Silver;6",961/3600,0,0)
rr<-c("Silver","2018-09-08;Silver;Bridge",554/3600,0,0)
ss<-c("Silver","2018-10-05;Silver;2",964/3600,0,0)
tt<-c("Silver","2018-10-05;Silver;3",1208/3600,0,0)
uu<-c("Silver","2018-10-05;Silver;4",890/3600,0,0)
vv<-c("Silver","2018-10-05;Silver;5",594/3600,0,0)
ww<-c("Silver","2018-10-05;Silver;6",804/3600,0,0)
xx<-c("Silver","2018-10-05;Silver;1",1132/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,
                           aa,bb,cc,dd,ee,ff,gg,hh,ii,jj,kk,ll,mm,nn,oo,pp,qq,rr,ss,tt,uu,vv,ww,xx)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
bib.cpue<-rbind(bib.cpue,add.on)

#################################
#
#         South Twin
# buff
a<-c("S. Twin","2018-05-21;S. Twin;2",900/3600,0,0)

b<-c("S. Twin","2018-06-05;S. Twin;1",900/3600,0,0)
c<-c("S. Twin","2018-06-05;S. Twin;3",900/3600,0,0)
d<-c("S. Twin","2018-06-05;S. Twin;4",900/3600,0,0)

e<-c("S. Twin","2018-06-18;S. Twin;1",900/3600,0,0)
f<-c("S. Twin","2018-06-18;S. Twin;2",900/3600,0,0)
g<-c("S. Twin","2018-06-18;S. Twin;3",900/3600,0,0)
h<-c("S. Twin","2018-06-18;S. Twin;4",900/3600,0,0)

l<-c("S. Twin","2018-07-05;S. Twin;1",900/3600,0,0)
m<-c("S. Twin","2018-07-05;S. Twin;3",900/3600,0,0)

q<-c("S. Twin","2018-07-13;S. Twin;1",900/3600,0,0)
r<-c("S. Twin","2018-07-13;S. Twin;2",900/3600,0,0)
s<-c("S. Twin","2018-07-13;S. Twin;3",900/3600,0,0)
t<-c("S. Twin","2018-07-13;S. Twin;4",900/3600,0,0)

u<-c("S. Twin","2018-08-31;S. Twin;2",900/3600,0,0)

v<-c("S. Twin","2018-09-04;S. Twin;1",900/3600,0,0)
w<-c("S. Twin","2018-09-04;S. Twin;4",900/3600,0,0)

x<-c("S. Twin","2018-08-03;S. Twin;1",900/3600,0,0)
y<-c("S. Twin","2018-08-03;S. Twin;2",900/3600,0,0)
z<-c("S. Twin","2018-08-03;S. Twin;3",900/3600,0,0)
aa<-c("S. Twin","2018-08-03;S. Twin;4",900/3600,0,0)

bb<-c("S. Twin","2018-08-07;S. Twin;1",900/3600,0,0)
cc<-c("S. Twin","2018-08-07;S. Twin;2",900/3600,0,0)
dd<-c("S. Twin","2018-08-07;S. Twin;3",900/3600,0,0)
ee<-c("S. Twin","2018-08-07;S. Twin;4",900/3600,0,0)

ff<-c("S. Twin","2018-08-14;S. Twin;1",1202/3600,0,0)
gg<-c("S. Twin","2018-08-14;S. Twin;2",1200/3600,0,0)
hh<-c("S. Twin","2018-08-14;S. Twin;3",1200/3600,0,0)

ii<-c("S. Twin","2018-08-17;S. Twin;2",1363/3600,0,0)

jj<-c("S. Twin","2018-08-15;S. Twin;1",1202/3600,0,0)
kk<-c("S. Twin","2018-08-15;S. Twin;2",1389/3600,0,0)
ll<-c("S. Twin","2018-08-15;S. Twin;3",1206/3600,0,0)
mm<-c("S. Twin","2018-08-15;S. Twin;4",1200/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,l,m,q,r,s,t,u,v,w,x,y,z,
                           aa,bb,cc,dd,ee,ff,gg,hh,ii,jj,kk,ll,mm)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
bib.cpue<-rbind(bib.cpue,add.on)


# carp now
a<-c("S. Twin","2018-07-25;S. Twin;1",1204/3600,0,0)
b<-c("S. Twin","2018-07-25;S. Twin;2",1207/3600,0,0)
c<-c("S. Twin","2018-08-09;S. Twin;1",1471/3600,0,0)
d<-c("S. Twin","2018-08-09;S. Twin;4",1200/3600,0,0)
e<-c("S. Twin","2018-10-11;S. Twin;4",900/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
coc.cpue<-rbind(coc.cpue,add.on)


##########################################################
#
#
#         STORM LAKE. THE FINAL FRONTIER
#
# 5 CARP

a<-c("Storm","2018-08-03;Storm;5", 954/3600,0,0)
b<-c("Storm","2018-08-03;Storm;7", 445/3600,0,0)
c<-c("Storm","2018-08-08;Storm;1", 902/3600,0,0)
d<-c("Storm","2018-08-08;Storm;5", 804/3600,0,0)
e<-c("Storm","2018-10-05;Storm;5", 1623/3600,0,0)
f<-c("Storm","2018-08-08;Storm;9", 804/3600,0,0)


add.on<-data.frame(t(data.frame(a,b,c,d,e,f)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
coc.cpue<-rbind(coc.cpue,add.on)

# 60+ buffalo
a<-c("Storm","2018-05-21;Storm;1", 910/3600,0,0)
b<-c("Storm","2018-05-21;Storm;2", 903/3600,0,0)
c<-c("Storm","2018-05-21;Storm;4", 928/3600,0,0)
d<-c("Storm","2018-05-21;Storm;5", 925/3600,0,0)
e<-c("Storm","2018-05-21;Storm;7", 901/3600,0,0)
f<-c("Storm","2018-05-21;Storm;9", 903/3600,0,0)
g<-c("Storm","2018-05-21;Storm;Bonus 2", 984/3600,0,0)
h<-c("Storm","2018-05-21;Storm;Bonus 3", 1022/3600,0,0)

i<-c("Storm","2018-06-07;Storm;1", 1205/3600,0,0)
j<-c("Storm","2018-06-07;Storm;2", 955/3600,0,0)
k<-c("Storm","2018-06-07;Storm;4", 863/3600,0,0)


rrr<-c("Storm","2018-06-08;Storm;1", 901/3600,0,0)
l<-c("Storm","2018-06-08;Storm;2", 944/3600,0,0)
m<-c("Storm","2018-06-08;Storm;4", 914/3600,0,0)
n<-c("Storm","2018-06-08;Storm;5", 1579/3600,0,0)
o<-c("Storm","2018-06-08;Storm;9", 1107/3600,0,0)
p<-c("Storm","2018-06-08;Storm;10", 969/3600,0,0)
q<-c("Storm","2018-06-08;Storm;11", 441/3600,0,0)

r<-c("Storm","2018-06-13;Storm;2", 1418/3600,0,0)

s<-c("Storm","2018-06-27;Storm;1", 918/3600,0,0)
t<-c("Storm","2018-06-27;Storm;2", 1009/3600,0,0)
u<-c("Storm","2018-06-27;Storm;4", 1151/3600,0,0)
v<-c("Storm","2018-06-27;Storm;8", 998/3600,0,0)
w<-c("Storm","2018-06-27;Storm;9", 948/3600,0,0)
x<-c("Storm","2018-06-27;Storm;10", 1279/3600,0,0)

y<-c("Storm","2018-07-16;Storm;1", 948/3600,0,0)
z<-c("Storm","2018-07-16;Storm;2", 944/3600,0,0)
aa<-c("Storm","2018-07-16;Storm;4", 959/3600,0,0)
bb<-c("Storm","2018-07-16;Storm;5", 1089/3600,0,0)
cc<-c("Storm","2018-07-16;Storm;9", 891/3600,0,0)
dd<-c("Storm","2018-07-16;Storm;Bonus", 3418/3600,0,0)

ee<-c("Storm","2018-07-17;Storm;3", 1952/3600,0,0)
ff<-c("Storm","2018-07-17;Storm;4", 1484/3600,0,0)
gg<-c("Storm","2018-07-17;Storm;5", 3079/3600,0,0)
hh<-c("Storm","2018-07-17;Storm;6", 852/3600,0,0)

ii<-c("Storm","2018-07-24;Storm;1", 2491/3600,0,0)
jj<-c("Storm","2018-07-24;Storm;2", 1510/3600,0,0)
kk<-c("Storm","2018-07-24;Storm;3", 3818/3600,0,0)
ll<-c("Storm","2018-07-24;Storm;4", 1729/3600,0,0)
mm<-c("Storm","2018-07-24;Storm;5", 1648/3600,0,0)

nn<-c("Storm","2018-07-31;Storm;1", 3555/3600,0,0)
oo<-c("Storm","2018-07-31;Storm;2", 3225/3600,0,0)
pp<-c("Storm","2018-07-31;Storm;3", 3671/3600,0,0)
qq<-c("Storm","2018-07-31;Storm;4", 3717/3600,0,0)
rr<-c("Storm","2018-07-31;Storm;5", 1648/3600,0,0)

ss<-c("Storm","2018-08-03;Storm;5", 954/3600,0,0)
tt<-c("Storm","2018-08-03;Storm;7", 445/3600,0,0)
uu<-c("Storm","2018-08-03;Storm;4", 955/3600,0,0)
vv<-c("Storm","2018-08-03;Storm;9", 822/3600,0,0)
ww<-c("Storm","2018-08-03;Storm;2", 914/3600,0,0)

xx<-c("Storm","2018-08-08;Storm;9", 804/3600,0,0)
yy<-c("Storm","2018-08-08;Storm;7", 999/3600,0,0)
zz<-c("Storm","2018-08-08;Storm;1", 804/3600,0,0)
aaa<-c("Storm","2018-08-08;Storm;2", 948/3600,0,0)
bbb<-c("Storm","2018-08-08;Storm;4", 889/3600,0,0)
ccc<-c("Storm","2018-08-08;Storm;5", 956/3600,0,0)
ddd<-c("Storm","2018-08-08;Storm;Bonus 1", 933/3600,0,0)

eee<-c("Storm","2018-08-14;Storm;2", 2649/3600,0,0)
fff<-c("Storm","2018-08-14;Storm;3", 1847/3600,0,0)
ggg<-c("Storm","2018-08-14;Storm;4", 1552/3600,0,0)

hhh<-c("Storm","2018-09-09;Storm;1", 903/3600,0,0)
iii<-c("Storm","2018-09-09;Storm;4", 866/3600,0,0)
jjj<-c("Storm","2018-09-09;Storm;5", 1040/3600,0,0)
kkk<-c("Storm","2018-09-09;Storm;9", 902/3600,0,0)

lll<-c("Storm","2018-10-05;Storm;1", 945/3600,0,0)
mmm<-c("Storm","2018-10-05;Storm;2", 828/3600,0,0)
nnn<-c("Storm","2018-10-05;Storm;4", 867/3600,0,0)
ooo<-c("Storm","2018-10-05;Storm;5", 1623/3600,0,0)
ppp<-c("Storm","2018-10-05;Storm;7", 1230/3600,0,0)
qqq<-c("Storm","2018-10-05;Storm;9", 944/3600,0,0)

add.on<-data.frame(t(data.frame(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,
                           aa,bb,cc,dd,ee,ff,gg,hh,ii,jj,kk,ll,mm,nn,oo,pp,qq,rr,ss,tt,uu,vv,ww,xx,yy,zz,
                           aaa,bbb,ccc,ddd,eee,fff,ggg,hhh,iii,jjj,kkk,lll,mmm,nnn,ooo,ppp,qqq,rrr)),
                   stringsAsFactors = F)
names(add.on)<-c("Lake","DLR","Effort","n","cpue")
add.on$n<-as.numeric(add.on$n)
add.on$cpue<-as.numeric(add.on$cpue)
add.on$Effort<-as.numeric(add.on$Effort)
add.on$Lake<-as.factor(add.on$Lake)
add.on$DLR<-as.factor(add.on$DLR)
str(add.on)
bib.cpue<-rbind(bib.cpue,add.on)


######
# checking the data frames

setdiff(coc.cpue$DLR,bib.cpue$DLR) # entries in coc not in bib (BLUE lake)
setdiff(bib.cpue$DLR,coc.cpue$DLR) # entries in bib not in coc 

################ ALLLL DONNNNEEEE  ##########################

```

```{r}
#
#   checking to see if I can split up DLR now
coc.cpue$DLR<-as.character(coc.cpue$DLR)
coc.cpue2<-data.frame(do.call(rbind,strsplit(coc.cpue$DLR,
                                      "\\-|\\-|\\;|\\;")))
# need to adjust column names then we are in business

coc.cpue2
```






```{r,}
# need a boxplot of CPUE for each lake apparently. Let's see:


boxplot(cpue~Lake,data=coc.cpue,
        main="Carp CPUE by Lake: 2018")

boxplot(cpue~Lake,data=bib.cpue,
        main="Buffalo CPUE by Lake: 2018")


###################################################
# hopefully find summary stats for below
###################################################


# CarpLL - lower bound for y axis 
# CarpUL- upper bound for y axis
COC.CPUE.95ci<-groupwiseMean(cpue ~ Lake,
              data = coc.cpue,
              conf = 0.95,
              digits = 3)

# BuffLL - lower bound for y axis
# BuffUL - upper bound for y axis
BIB.CPUE.95ci<-groupwiseMean(cpue ~ Lake,
              data = bib.cpue,
              conf = 0.95,
              digits = 3)


```

put that ish together


```{r,}

DF<-merge(BM,COC.CPUE.95ci)
colnames(BIB.CPUE.95ci)<-c("Lake","B.CPUE.N","B.MeanCPUE","B.Conf.level","B.CPUE.LL","C.CPUE.LL")
B<-c("Blue",NA,NA,NA,NA,NA)
BIB.CPUE.95ci<-rbind(BIB.CPUE.95ci,B)
DF<-merge(DF,BIB.CPUE.95ci)


colnames(DF)<-c("Lake","CarpBM.LL","CarpBiomass","CarpBM.UL","CarpDensity.LL","CarpDensity","CarpDensity.UL",
                "BuffBM.LL","BuffBiomass","BuffBM.UL","BuffDensity.LL","BuffDensity","BuffDensity.UL","CarpN","BuffN",
                "C.CPUE.N","C.MeanCPUE","C.Conf.level","C.CPUE.LL","C.CPUE.UL",
                "B.CPUE.N","B.MeanCPUE","B.Conf.level","B.CPUE.LL","B.CPUE.UL")
DF$B.CPUE.N<-as.numeric(DF$B.CPUE.N)
DF$B.MeanCPUE<-as.numeric(DF$B.MeanCPUE)
DF$B.Conf.level<-as.numeric(DF$B.Conf.level)
DF$B.CPUE.LL<-as.numeric(DF$B.CPUE.LL)
DF$B.CPUE.UL<-as.numeric(DF$B.CPUE.UL)
summary(DF)

DF$BuffBM.LL[DF$BuffBM.LL <= 0 ]<-0
DF$BuffDensity.LL[DF$BuffDensity.LL <=0]<-0
#write.csv(DF,"2018BiomassCPUEtable.csv")
```

Pat yourself on the back! we are in business. Now to build A plot

# X axis: Biomass in pounds
# Y axis: CPUE: #fish/hour

__Same as 2017 annual report here:__

- in next chunk will switch to biomass density

```{r}

# visualize how CPUE changes as a function of biomass....

mod<-lm(C.MeanCPUE ~ CarpBiomass, data = DF)
summary(mod)
R2<-format(summary(mod)$r.squared,digits=3)
R2


# Carp First
carp<-ggplot(DF, aes(x=CarpBiomass, y=C.MeanCPUE)) +
  xlim(0,300000)+ # increase of 100k
  ylim(0,250)+ # more than double from 2017
  geom_point(size=4) +
  geom_errorbar(aes(ymax = C.CPUE.UL, ymin = C.CPUE.LL),width=5000) +
  geom_errorbarh(aes(xmax= CarpBM.UL, xmin = CarpBM.LL),height=5) +
  annotate("text",x=c(135000,30000,200000,8000,37000,100000,60000,15000,15000),y=c(200,8,30,25,45,25,30,180,160), 
           label = c("Blue","Center","Five Island","N Twin","Silver","S Twin","Storm","R^2 = 0.238","p = 0.267")) +
  labs(title = "2018 Common Carp Biomass and CPUE",
       x = "Estimated Common Carp Biomass (lbs.)",
       y = "Catch per Unit Effort (fish/hour)") +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  geom_smooth(method=lm,se=F) 


# Buffalo Second

mod2<-lm(B.MeanCPUE ~ BuffBiomass, data = DF)
summary(mod2)
R22<-format(summary(mod2)$r.squared,digits=3)
R22

buff<-ggplot(DF, aes(x=BuffBiomass, y=B.MeanCPUE)) +
  xlim(0,300000)+ 
  ylim(0,50)+ 
  geom_point(size=4) +
  geom_errorbar(aes(ymax = B.CPUE.UL, ymin = B.CPUE.LL),width=5000) +
  geom_errorbarh(aes(xmax=BuffBM.UL, xmin = BuffBM.LL),height=5) +
  annotate("text",x=c(18000,19000,186000,152000,103000,148000,20000,20000),y=c(22,1,18,22,33,3,40,35), 
           label = c("Center","Five Island","N Twin","Silver","S Twin","Storm","R^2 = 0.00009","p = 0.985")) +
  labs(title = "2018 Bigmouth Buffalo Biomass and CPUE",
       x = "Estimated Bigmouth Buffalo Biomass (lbs.)",
       y = "Catch per Unit Effort (fish/hour)") +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  geom_smooth(method=lm,se=F)

# Problems here: when I remove the 0s from Blue Lake Buffalo, the regression is negative
# And the plot certainly doesn't look linear

grid.arrange(carp,buff,nrow=2,ncol=1)

```

New plot for prairie lakes conference:

# X axis: fish density (# fish / acre )
# Y axis: CPUE: #fish/hour

```{r}

# visualize how CPUE changes as a function of biomass....

mod<-lm(C.MeanCPUE ~ CarpDensity, data = DF)
summary(mod)
R2<-format(summary(mod)$r.squared,digits=3)
R2


# Carp First
carp<-ggplot(DF, aes(x=CarpDensity, y=C.MeanCPUE)) +
  xlim(0,650)+ # 
  ylim(0,300)+ # 
  geom_point(size=4) +
  geom_errorbar(aes(ymax = C.CPUE.UL, ymin = C.CPUE.LL),width=50000) +
  geom_errorbarh(aes(xmax= CarpDensity.UL, xmin = CarpDensity.LL),height=8) +
  annotate("text",x=c(520,184,187,67,96,61,11,250,250),y=c(220,5,40,8,70,30,50,180,160), 
           label = c("Blue","Center","Five Island","N Twin","S Twin","Silver","Storm","R^2 = 0.812","p = 0.006")) +
  labs(title = "2018 Common Carp Density and CPUE",
       x = "Estimated Common Carp Density (lbs./acre)",
       y = "Catch per Unit Effort (fish/hour)") +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  geom_smooth(method=lm,se=F) 


# Buffalo Second

mod2<-lm(B.MeanCPUE ~ BuffDensity, data = DF)
summary(mod2)
R22<-format(summary(mod2)$r.squared,digits=3)
R22

buff<-ggplot(DF, aes(x=BuffDensity, y=B.MeanCPUE)) +
  xlim(0,650)+ 
  ylim(0,50)+ 
  geom_point(size=4) +
  geom_errorbar(aes(ymax = B.CPUE.UL, ymin = B.CPUE.LL),width=5000) +
  geom_errorbarh(aes(xmax=BuffDensity.UL, xmin = BuffDensity.LL),height=3) +
  annotate("text",x=c(20,59,412,130,225,55,20,20),y=c(8,13,7,22,15,0,40,37), 
           label = c("Five Island","Center","N Twin","S Twin","Silver","Storm","R^2 = 0.086","p = 0.573")) +
  labs(title = "2018 Bigmouth Buffalo Density and CPUE",
       x = "Estimated Bigmouth Buffalo Density (lbs./acre)",
       y = "Catch per Unit Effort (fish/hour)") +
  theme_bw() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  geom_smooth(method=lm,se=F)

# Problems here: when I remove the 0s from Blue Lake Buffalo, the regression is negative
# And the plot certainly doesn't look linear

grid.arrange(carp,buff,nrow=2,ncol=1)

```

# New plot of CPUE on y axis and date on x axis

```{r,}
# Overall with all lakes
# Carp
blue.cpue<-droplevels(subset(coc.cpue, Lake == "Blue"))
plot(cpue~DLR, data = blue.cpue)

center.cpue<-droplevels(subset(coc.cpue, Lake == "Center"))
plot(cpue~DLR, data = center.cpue)

FI.cpue<-droplevels(subset(coc.cpue, Lake == "5 Island"))
plot(cpue~DLR, data = FI.cpue)

NT.cpue<-droplevels(subset(coc.cpue, Lake == "N. Twin"))
plot(cpue~DLR, data = NT.cpue)

Silver.cpue<-droplevels(subset(coc.cpue, Lake == "Silver"))
plot(cpue~DLR, data = Silver.cpue)

ST.cpue<-droplevels(subset(coc.cpue, Lake == "S. Twin"))
plot(cpue~DLR, data = ST.cpue)

Storm.cpue<-droplevels(subset(coc.cpue, Lake == "Storm"))
plot(cpue~DLR, data = Storm.cpue)




# Buff
center.cpue<-droplevels(subset(bib.cpue, Lake == "Center"))
plot(cpue~DLR, data = center.cpue)

FI.cpue<-droplevels(subset(bib.cpue, Lake == "5 Island"))
plot(cpue~DLR, data = FI.cpue)

NT.cpue<-droplevels(subset(bib.cpue, Lake == "N. Twin"))
plot(cpue~DLR, data = NT.cpue)

Silver.cpue<-droplevels(subset(bib.cpue, Lake == "Silver"))
plot(cpue~DLR, data = Silver.cpue)

ST.cpue<-droplevels(subset(bib.cpue, Lake == "S. Twin"))
plot(cpue~DLR, data = ST.cpue)

Storm.cpue<-droplevels(subset(bib.cpue, Lake == "Storm"))
plot(cpue~DLR, data = Storm.cpue)


# DLR column is not in chronological order :*(

```











#####

# Derek Ogle's Chapter 7: CPUE

This file is from the Chapter7-FishR file on desktop's desktop (LOL)

-packages and options:
```{r}
packages(FSA)
packages(car)
packages(Hmisc)
packages(multcomp)

options(width=90,continue=" ",show.signif.stars=F,
        contrasts=c("contr.sum","contr.poly"))
par(mar=c(3.5,3.5,1,1), mgp=c(2.1,0.4,0),tcl=-0.2)
```


-detections of changes in relative abundance with highly variable cpue data
an example:

```{r}
year <- 0:14 # years for simulation
N0 <- 10000 # initial population size
A <- 0.95 # annual survival rate
abund <- round(N0*A^year,0) # abundance from exponential decay model
cpe <- round(abund/1000,1) # simulated cpe data
cbind(year,abund) # for display only
```

now randocm cpue data

```{r}
me1 <- c(-0.10,-0.05,0.05,0.10)
me1a <- sample(me1,length(cpe),replace=TRUE)
cpe.me1 <- round(cpe+cpe*me1a,1)
# 20 and 40 % error below
me2 <- c(-0.4,-0.2,0.1,0.4)
me2a <- sample(me2,length(cpe),replace=TRUE)
cpe.me2 <- round(cpe+cpe*me2a,1)
( d1 <- data.frame(year,abund,cpe,cpe.me1,cpe.me2) ) # for storage

plot(cpe~year,data=d1,ylim=c(0,15),xlab="Year",ylab="CPE",type="l",lwd=2,col="black")
points(d1$year,d1$cpe.me1,type="b",pch=19,lwd=1,col="blue")
points(d1$year,d1$cpe.me2,type="b",pch=19,lwd=1,col="red")
legend("topright",legend=c("Truth","5 or 10%","20 or 40%"),col=c("black","blue","red"),
lwd=c(2,1,1),pch=c(NA,19,19))


# simulation to do same as plot just above
cpe.sim <- function(year,cpe,me1,me2=NULL) {
  cpe1 <- cpe + cpe*sample(me1,length(cpe),replace=TRUE)
  if (!is.null(me2)) cpe2 <- cpe + cpe*sample(me2,length(cpe),replace=TRUE)
  max.y <- max(c(cpe,cpe1,cpe2))
  plot(year,cpe,ylim=c(0,max.y),xlab="Year",ylab="CPE",type="l",lwd=2,col="black")
  points(year,cpe1,type="b",pch=19,lwd=1,col="blue")
  if (!is.null(me2)) points(year,cpe2,type="b",pch=19,lwd=1,col="red")
  if (is.null(me2)) legend("topright",legend=c("Truth","CPE1"),col=c("black","blue"),lwd=c(2,1),pch=19)
  else legend("topright",legend=c("Truth","CPE1","CPE2"),col=c("black","blue","red"),lwd=c(2,1,1),pch=19)
}

cpe.sim(d1$year,d1$cpe,me1,me2)
```


# new example with catfish
```{r}
d2 <- read.table("Box7_2.txt",header=TRUE)
str(d2)


# log transformation added to df in order to assess effects of data transformation
d2$logcpe.A <- log10(d2$cpe.A+1) # CCF population in reservoir 1
d2$logcpe.B <- log10(d2$cpe.B+1) # ccf population in reservoir 2
str(d2)

lapply(as.list(d2[,-1]),Summarize,digits=3)
hist(d2$cpe.A,main="CPUE frequency in reservoir A")
hist(d2$cpe.B,main="CPUE frequency in reservoir B")
hist(d2$logcpe.A,main="log transformed cpue in reservoir A")
hist(d2$logcpe.B,main="log transformed cpue in reservoir B")

# Power calculations: saving mean and SD for log-transformed cpue in reservoir B
( mn.B <- mean(d2$logcpe.B) )
( sd.B <- sd(d2$logcpe.B) )

# power test to detect 10% change in cpue
power.t.test(n=NULL,delta=mn.B*0.10,power=0.9,sig.level=0.05,sd=sd.B,type="two.sample",
              alt="one.sided")

power.t.test(n=NULL,delta=mn.B*0.20,power=0.8,sig.level=0.10,sd=sd.B,type="two.sample",
              alt="one.sided")


```

## he continues with habitat assessment and blocking. 
for now I'm frustrated at what example turned into.
walked around the builidng let's see who feels different.
nah.

```{r}
perc.delta <- seq(0.05,0.25,0.01)
deltas <- mn.B*perc.delta
p1 <- sapply(deltas,power.t.test,n=NULL,power=0.9,sig.level=0.05,sd=sd.B,type="two.sample",
              alt="one.sided")
p1.n <- as.numeric(p1["n",])
plot(p1.n~perc.delta,xlab="Proportion Population Decline",ylab="Sample Size",type="l",
              ylim=c(0,max(p1.n)))



```

