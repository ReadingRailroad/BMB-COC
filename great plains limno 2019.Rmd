---
title: "great plains limno"
author: "Marty Simonson"
date: "October 16, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r,include=F}
# front matter
rm(list=ls())

packages<-function(x, repos="http://cran.r-project.org", ...){
x<-as.character(match.call()[[2]])
if (!require(x,character.only=TRUE)){
install.packages(pkgs=x, repos=repos, ...)
require(x,character.only=TRUE)
}
}

packages(vegan)
packages(ggplot2)
packages(reshape2)
packages(nnet)
packages(multcomp)
packages(plyr)
packages(rv)
packages(arm)
packages(lattice)
packages(tikzDevice)
packages(gridExtra)
packages(dplyr)

packages(FSA)

```

In the annual report there should be code to

- put the biomass density of carp/buffalo on x axis, with error bars

- annual report shows CPUE on Y, but we can put WQ data
-- TN
-- TP
-- Algal Biomass

Basically limited to 2017 and 2018 as of 10/2019... not all WQ data entered and QC'd yet

# biomasses
```{r,}
setwd("~/BMB-COC")
seventeen<-read.csv("2017_BiomassDensityEstimates.csv", header = T)
eighteen<-read.csv("2018_BiomassDensityEstimates.csv",header=T)
nineteen<-read.csv("2019_BiomassDensityEstimates.csv", header = T) # not needed yet
# check that year col has been added to 2019

bm.frame<-rbind(seventeen,eighteen)
bm.frame<-bm.frame[,-1]
bm.frame
```

# water quality
melt and reshape
```{r}
blue<-read.csv("WaterQuality/BlueWQ.csv",header=T)
center<-read.csv("WaterQuality/CenterWQ.csv",header=T)
fiveisland<-read.csv("WaterQuality/FiveIslandWQ.csv",header=T)
ntwin<-read.csv("WaterQuality/NTwinWQ.csv",header=T)
silver<-read.csv("WaterQuality/SilverWQ.csv",header=T)
stwin<-read.csv("WaterQuality/STwinWQ.csv",header=T)
storm<-read.csv("WaterQuality/StormWQ.csv",header=T)

##########################################################################################
# S twin is simplist. This is ideal frame to get mean and ci
head(stwin)




# Start with Blue from Aquia format
head(blue)
# change date
blue$sampleDate<-as.Date(blue$sampleDate)
blue$Year<-factor(format(blue$sampleDate, "%Y"))
summary(blue$Year)
# subset for my three years
blue<-droplevels(subset(blue, Year == "2017" |
                   Year == "2018" |
                   Year == "2019"))
# now to trim the fat
str(blue)
blue<-blue[,c(3,7,10,11,27)]
head(blue)
# melt and cast
blue.melt<-melt(blue)
blue.c<-dcast(blue.melt, name+Year+analyte~)
```